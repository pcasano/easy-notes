@if (selectedNote()) {
  <form [formGroup]="noteForm">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center gap-2">
        <h3 class="mb-0">{{ noteForm.get('title')?.value }}</h3>
        <span class="badge {{ selectedNote()?.tag?.class }}">{{
          selectedNote()?.tag?.name
        }}</span>
      </div>

      @if (this.tab() === Tab.Notes) {
        <div class="d-flex align-items-center gap-2">
          @if (tags.length > 0) {
            Tag
            <select
              class="form-select w-auto"
              formControlName="tag"
              (change)="onTagChange($event)"
            >
              <option value=""></option>
              @for (tag of tags; track tag) {
                <option [value]="tag.name">{{ tag.name }}</option>
              }
            </select>
          }

          <div class="form-check mb-0">
            <input
              type="checkbox"
              class="form-check-input"
              id="pinned"
              formControlName="pinned"
              (change)="onPinToggle($event)"
            />
            <label class="form-check-label" for="pinned"> Pin </label>
          </div>
        </div>
      }
    </div>

    <div class="mb-3">
      <input
        type="text"
        id="title"
        class="form-control"
        formControlName="title"
        placeholder="Enter note title"
      />
    </div>

    <div class="mb-3">
      <label for="content" class="form-label">Content</label>
      <textarea
        id="content"
        class="form-control"
        rows="10"
        formControlName="content"
        placeholder="Enter note content"
      ></textarea>
    </div>
    <div class="d-flex justify-content-between align-items-start">
      <div class="d-flex flex-column">
        @if (settings.showCreationDate) {
          <div>
            Created: {{ selectedNote()?.createdAt | date: 'dd.MM.yyyy HH:mm' }}
          </div>
        }
        @if (selectedNote()?.editedAt && settings.showEditDate) {
          <div>
            Edited:
            {{ selectedNote()?.editedAt | date: 'dd.MM.yyyy HH:mm' }}
          </div>
        }
        @if (
          tab() === Tab.Trash &&
          selectedNote()?.movedToTrashAt &&
          settings.showMovedToTrashDate
        ) {
          <div>
            Deleted:
            {{ selectedNote()?.movedToTrashAt | date: 'dd.MM.yyyy HH:mm' }}
          </div>
        }
      </div>
      <div>
        @if (tab() === Tab.Trash || tab() === Tab.Archive) {
          <button
            type="button"
            class="btn btn-primary me-2"
            (click)="onRestore()"
          >
            {{ tab() === Tab.Archive ? 'Move to Inbox' : 'Restore' }}
          </button>
        }
        @if (tab() === Tab.Notes && settings.activeArchive) {
          <button
            type="button"
            class="btn btn-primary me-2"
            (click)="onArchive()"
          >
            Archive note
          </button>
        }
        <button
          type="button"
          class="btn btn-danger"
          (click)="
            tab() === Tab.Notes || tab() === Tab.Archive
              ? onMoveToTrash()
              : onDelete()
          "
        >
          {{
            tab() === Tab.Notes || tab() === Tab.Archive
              ? 'Delete'
              : 'Delete from Trash'
          }}
          <i class="bi bi-trash3"></i>
        </button>
      </div>
    </div>
  </form>
} @else {
  <div></div>
}
